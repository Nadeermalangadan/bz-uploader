/*! bzUploader v0.1.0 by Vitalii Savchuk(esvit666@gmail.com) - https://github.com/esvit/bz-uploader - New BSD License */
!function(a,b){return"function"==typeof define&&define.amd?(define("bzUploader",["angular","angular-file-upload"],function(a,c){return b(c)}),void 0):b(a)}(angular||null,function(a){var b=a.module("bzUploader",["angularFileUpload"]);b.factory("ngTableParams",["$q",function(b){var c=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},d=function(d,e){var f=this;this.parameters=function(b,d){if(d=d||!1,a.isDefined(b)){for(var e in b){var f=b[e];if(d&&e.indexOf("[")>=0){for(var h=e.split(/\[(.*)\]/).reverse(),i="",j=0,k=h.length;k>j;j++){var l=h[j];if(""!==l){var m=f;f={},f[i=l]=c(m)?parseFloat(m):m}}"sorting"===i&&(g[i]={}),g[i]=a.extend(g[i]||{},f[i])}else g[e]=c(b[e])?parseFloat(b[e]):b[e]}return this}return g},this.settings=function(b){return a.isDefined(b)?(h=a.extend(h,b),this):h},this.page=function(b){return a.isDefined(b)?this.parameters({page:b}):g.page},this.total=function(b){return a.isDefined(b)?this.settings({total:b}):h.total},this.count=function(b){return a.isDefined(b)?this.parameters({count:b,page:1}):g.count},this.filter=function(b){return a.isDefined(b)?this.parameters({filter:b}):g.filter},this.sorting=function(b){return a.isDefined(b)?this.parameters({sorting:b}):g.sorting},this.orderBy=function(){var a=[];for(var b in g.sorting)a.push(("asc"===g.sorting[b]?"+":"-")+b);return a},this.getData=function(a){a.resolve([])},this.getGroups=function(c,d){var e=b.defer();e.promise.then(function(b){var e={};for(var f in b){var g=b[f],h=a.isFunction(d)?d(g):g[d];e[h]=e[h]||{data:[]},e[h].value=h,e[h].data.push(g)}var i=[];for(var j in e)i.push(e[j]);c.resolve(i)}),this.getData(e,f)},this.generatePagesArray=function(a,b,c){var d,e,f,g,h,j;if(d=11,j=[],h=Math.ceil(b/c),h>1){for(j.push({type:"prev",number:Math.max(1,a-1),active:a>1}),j.push({type:"first",number:1,active:a>1}),f=Math.round((d-5)/2),g=Math.max(2,a-f),e=Math.min(h-1,a+2*f-(a-g)),g=Math.max(2,g-(2*f-(e-g))),i=g;e>=i;)i===g&&2!==i||i===e&&i!==h-1?j.push({type:"more",active:!1}):j.push({type:"page",number:i,active:a!==i}),i++;j.push({type:"last",number:h,active:a!==h}),j.push({type:"next",number:Math.min(h,a+1),active:h>a})}return j},this.url=function(b){b=b||!1;var c=b?[]:{};for(key in g)if(g.hasOwnProperty(key)){var d=g[key],e=encodeURIComponent(key);if("object"==typeof d){for(var f in d)if(!a.isUndefined(d[f])&&""!==d[f]){var h=e+"["+encodeURIComponent(f)+"]";b?c.push(h+"="+encodeURIComponent(d[f])):c[h]=encodeURIComponent(d[f])}}else a.isFunction(d)||a.isUndefined(d)||""===d||(b?c.push(e+"="+encodeURIComponent(d)):c[e]=encodeURIComponent(d))}return c},this.reload=function(){var a=b.defer(),c=this;h.$loading=!0,h.groupBy?h.getGroups(a,h.groupBy,this):h.getData(a,this),a.promise.then(function(a){h.$loading=!1,h.groupBy?h.$scope.$groups=a:h.$scope.$data=a,h.$scope.pages=c.generatePagesArray(c.page(),c.total(),c.count())})};var g=this.$params={page:1,count:1,filter:{},sorting:{},group:{},groupBy:null},h={$scope:null,$loading:!1,total:0,counts:[10,25,50,100],getGroups:this.getGroups,getData:this.getData};return this.settings(e),this.parameters(d,!0),this};return d}]);var c=["$scope","$fileUploader","$parse",function(b,c,d){b.autoupload=b.autoupload||!1,b.text=b.text||"Upload";var e=c.create({scope:b,url:b.url.replace("\\:",":"),filters:[function(){return!0}]});b.uploader=e,e.filters.push(function(){return!0}),e.bind("afteraddingfile",function(){}),e.bind("afteraddingall",function(){b.autoupload&&e.uploadAll()}),e.bind("changedqueue",function(){}),e.bind("beforeupload",function(){}),e.bind("progress",function(){}),e.bind("success",function(c,f,g){var h=d(f.response)();b.files=b.files||[],b.files.push(h),a.forEach(e.queue,function(a,b){a==g&&e.queue.splice(b,1)}),console.log("Success: ",h)}),e.bind("complete",function(){}),e.bind("error",function(a,b,c){console.log("Complete: ",c),c.remove(),c.progress=100}),e.bind("progressall",function(a,b){e.progress=b}),e.bind("completeall",function(){console.log("All files are transferred"),e.progress=100}),b.deleteFiles=function(){b.files=[]},b.deleteFile=function(c){a.forEach(b.files,function(a,d){a==c&&(b.files.splice(d,1),console.info(c))})}}];return b.directive("bzUploader",[function(){return{restrict:"A",scope:{url:"=bzUploader",files:"=ngModel",autoupload:"="},controller:c,templateUrl:"bz-uploader/uploader.html",replace:!0,transclude:!0,require:"?ngModel"}}]),a.module("bzUploader").run(["$templateCache",function(a){a.put("bz-uploader/uploader.html",'<div class="bz-uploader" ng-file-drop> <div class="btn-upload"> <a href="" class="btn btn-default">Upload</a> <input class="btn-file-uploader" ng-file-select type="file" multiple/> </div> <div class="progress-uploaded" ng-if="uploader.queue.length && !autoupload"> <div> <b>Progress:</b> {{ uploader.progress }} <div class="progress progress-striped active"> <div class="bar" ng-style="{ \'width\': uploader.progress + \'%\' }"></div> </div> </div> <div class="btn-group"> <a class="btn btn-danger" ng-href="#" ng-click="$event.preventDefault(); uploader.uploadAll()">Загрузить все</a> <a class="btn btn-inverse" ng-href="#" ng-click="$event.preventDefault(); uploader.clearQueue()">Удалить все</a> </div> </div> <div class="upload-files" ng-if="uploader.queue.length"> <h4>Для загрузки выбрано {{ uploader.queue.length }} файла(ов).</h4> <ul class="list-unstyled"> <li ng-repeat="item in uploader.queue"> <div ng-show="item.isUploaded" style="float: left; margin-right: 10px">{{ item.file.name }}</div> <div class="row" ng-if="!item.isUploaded"> <div class="col col-lg-8"> <div class="progress"> <span>{{ item.file.name }}</span> <div class="progress-bar progress-bar-info" ng-style="{ \'width\': item.progress + \'%\' }"> <span>{{ item.file.name }}</span> </div> </div> </div> <div class="col col-lg-4"> <div class="btn-group"> <a class="btn btn-default btn-sm" ng-href="" ng-click="$event.preventDefault(); item.upload()" ng-disabled="item.isUploaded"> <span class="fa fa-upload"></span> </a> <a class="btn btn-danger btn-sm" ng-href="" ng-click="$event.preventDefault(); item.remove()"> <span class="fa fa-trash-o"></span> </a> </div> </div> </div> </li> </ul> </div> <div class="uploaded-files" ng-if="files.length"> <div ng-transclude></div> <div class="clearfix"></div> <a class="btn btn-inverse" ng-href="" ng-click="deleteFiles()">Удалить все</a> </div> </div>')}]),b});